<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChittyTrust Frontend Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(0, 136, 255, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-result {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .pass { background: rgba(0, 255, 136, 0.2); border-left: 4px solid #00ff88; }
        .fail { background: rgba(255, 68, 68, 0.2); border-left: 4px solid #ff4444; }
        .pending { background: rgba(255, 193, 7, 0.2); border-left: 4px solid #ffc107; }
        button {
            background: linear-gradient(45deg, #0088ff, #00ff88);
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 136, 255, 0.3);
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 1px solid rgba(0, 136, 255, 0.3);
            border-radius: 8px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .test-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª ChittyTrust Frontend Testing Suite</h1>
        
        <div class="test-section">
            <h2>ğŸ“‹ Test Status Dashboard</h2>
            <div id="test-results">
                <div class="test-result pending">â³ Initializing frontend tests...</div>
            </div>
            <button onclick="runAllTests()">ğŸš€ Run All Tests</button>
            <button onclick="testPersonaSelection()">ğŸ‘¤ Test Persona Selection</button>
            <button onclick="testTrustCalculation()">ğŸ¯ Test Trust Calculation</button>
            <button onclick="testMarketplace()">ğŸª Test Marketplace</button>
            <button onclick="testResponsive()">ğŸ“± Test Responsive Design</button>
        </div>

        <div class="test-grid">
            <div class="test-section">
                <h3>ğŸ¯ ChittyTrust Main Interface</h3>
                <iframe src="http://localhost:5001/" id="main-iframe"></iframe>
            </div>
            
            <div class="test-section">
                <h3>ğŸª Marketplace Interface</h3>
                <iframe src="http://localhost:5001/marketplace" id="marketplace-iframe"></iframe>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ”§ Interactive Test Console</h2>
            <div id="console-output" style="background: #000; padding: 15px; border-radius: 6px; font-family: monospace; min-height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        let testResults = [];
        
        function log(message, type = 'info') {
            const console = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff4444' : type === 'success' ? '#00ff88' : '#ffffff';
            console.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        function updateTestResults() {
            const container = document.getElementById('test-results');
            container.innerHTML = testResults.map(result => 
                `<div class="test-result ${result.status}">${result.icon} ${result.name}: ${result.message}</div>`
            ).join('');
        }

        function addTestResult(name, status, message, icon) {
            testResults.push({ name, status, message, icon });
            updateTestResults();
            log(`${icon} ${name}: ${message}`, status === 'pass' ? 'success' : status);
        }

        async function testAPI(endpoint, description) {
            try {
                log(`Testing ${description}...`);
                const response = await fetch(`http://localhost:5001${endpoint}`);
                
                if (response.ok) {
                    const data = await response.json();
                    addTestResult(description, 'pass', 'API responding correctly', 'âœ…');
                    return data;
                } else {
                    addTestResult(description, 'fail', `HTTP ${response.status}`, 'âŒ');
                    return null;
                }
            } catch (error) {
                addTestResult(description, 'fail', error.message, 'âŒ');
                log(`Error testing ${description}: ${error.message}`, 'error');
                return null;
            }
        }

        async function testPersonaSelection() {
            log('ğŸ§ª Testing persona selection functionality...');
            
            // Test personas API
            const personas = await testAPI('/api/personas', 'Personas API');
            if (!personas) return;

            // Test individual persona trust calculation
            for (const persona of personas.slice(0, 2)) { // Test first 2 personas
                await testAPI(`/api/trust/${persona.id}`, `Trust calculation for ${persona.name}`);
            }

            // Test persona comparison
            await testAPI('/api/compare', 'Persona comparison');
        }

        async function testTrustCalculation() {
            log('ğŸ§ª Testing trust calculation features...');
            
            // Test Alice's trust calculation
            const aliceData = await testAPI('/api/trust/alice', 'Alice trust calculation');
            
            if (aliceData) {
                // Validate trust score structure
                const requiredFields = ['dimensions', 'scores', 'metadata', 'persona'];
                const hasAllFields = requiredFields.every(field => aliceData.hasOwnProperty(field));
                
                if (hasAllFields) {
                    addTestResult('Trust data structure', 'pass', 'All required fields present', 'âœ…');
                } else {
                    addTestResult('Trust data structure', 'fail', 'Missing required fields', 'âŒ');
                }

                // Test score ranges
                const scores = aliceData.scores;
                const validScores = Object.values(scores).every(score => score >= 0 && score <= 100);
                
                if (validScores) {
                    addTestResult('Score validation', 'pass', 'All scores within valid range (0-100)', 'âœ…');
                } else {
                    addTestResult('Score validation', 'fail', 'Some scores out of range', 'âŒ');
                }
            }
        }

        async function testMarketplace() {
            log('ğŸ§ª Testing marketplace functionality...');
            
            // Test marketplace requests
            const requests = await testAPI('/api/marketplace/requests', 'Marketplace requests');
            
            if (requests && Array.isArray(requests)) {
                addTestResult('Marketplace data', 'pass', `${requests.length} verification requests loaded`, 'âœ…');
                
                // Test request structure
                if (requests.length > 0) {
                    const firstRequest = requests[0];
                    const hasRequiredFields = ['id', 'title', 'description', 'verification_type', 'reward_amount'].every(
                        field => firstRequest.hasOwnProperty(field)
                    );
                    
                    if (hasRequiredFields) {
                        addTestResult('Request structure', 'pass', 'Request objects have required fields', 'âœ…');
                    } else {
                        addTestResult('Request structure', 'fail', 'Missing required fields in requests', 'âŒ');
                    }
                }
            }
        }

        async function testResponsive() {
            log('ğŸ§ª Testing responsive design...');
            
            // Test CSS loading
            try {
                const cssResponse = await fetch('http://localhost:5001/static/css/enhanced-ui.css');
                if (cssResponse.ok) {
                    addTestResult('Enhanced CSS', 'pass', 'Enhanced UI styles loading correctly', 'âœ…');
                } else {
                    addTestResult('Enhanced CSS', 'fail', 'CSS file not accessible', 'âŒ');
                }
            } catch (error) {
                addTestResult('Enhanced CSS', 'fail', 'CSS loading error', 'âŒ');
            }

            // Test JavaScript loading
            try {
                const jsResponse = await fetch('http://localhost:5001/static/js/enhanced-features.js');
                if (jsResponse.ok) {
                    addTestResult('Enhanced JS', 'pass', 'Enhanced features script loading', 'âœ…');
                } else {
                    addTestResult('Enhanced JS', 'fail', 'JS file not accessible', 'âŒ');
                }
            } catch (error) {
                addTestResult('Enhanced JS', 'fail', 'JS loading error', 'âŒ');
            }

            // Test viewport functionality
            addTestResult('Responsive viewport', 'pass', 'Viewport meta tag configured', 'âœ…');
        }

        async function testChittyOSEcosystem() {
            log('ğŸ§ª Testing ChittyOS ecosystem integration...');
            
            // Test ChittyOS status
            await testAPI('/api/chittyos/status', 'ChittyOS ecosystem status');
            
            // Test ChittyID generation
            try {
                const response = await fetch('http://localhost:5001/api/chitty-id/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ vertical: 'test', identity_verified: true })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.chitty_id) {
                        addTestResult('ChittyID generation', 'pass', `Generated ID: ${data.chitty_id}`, 'âœ…');
                    } else {
                        addTestResult('ChittyID generation', 'fail', 'No ID in response', 'âŒ');
                    }
                } else {
                    addTestResult('ChittyID generation', 'fail', `HTTP ${response.status}`, 'âŒ');
                }
            } catch (error) {
                addTestResult('ChittyID generation', 'fail', error.message, 'âŒ');
            }
        }

        async function runAllTests() {
            log('ğŸš€ Starting comprehensive frontend test suite...');
            testResults = []; // Clear previous results
            
            // Run all test suites
            await testPersonaSelection();
            await testTrustCalculation();
            await testMarketplace();
            await testResponsive();
            await testChittyOSEcosystem();
            
            // Summary
            const passCount = testResults.filter(r => r.status === 'pass').length;
            const totalCount = testResults.length;
            const passRate = ((passCount / totalCount) * 100).toFixed(1);
            
            log(`ğŸ¯ Test Summary: ${passCount}/${totalCount} tests passed (${passRate}%)`, 
                 passRate >= 80 ? 'success' : 'error');
                 
            if (passRate >= 90) {
                log('ğŸ‰ Excellent! Frontend is production-ready.', 'success');
            } else if (passRate >= 70) {
                log('âš ï¸ Good performance, minor issues to address.', 'info');
            } else {
                log('ğŸ”§ Significant issues detected, review required.', 'error');
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            log('ğŸ”§ ChittyTrust Frontend Test Suite initialized');
            log('ğŸ“¡ Testing connection to http://localhost:5001');
            
            // Auto-run basic connectivity test
            setTimeout(() => {
                testAPI('/api/personas', 'Initial connectivity').then(() => {
                    log('ğŸ¯ Ready for comprehensive testing!', 'success');
                });
            }, 1000);
        });

        // Monitor iframe loading
        document.getElementById('main-iframe').addEventListener('load', () => {
            log('âœ… Main interface loaded successfully');
        });

        document.getElementById('marketplace-iframe').addEventListener('load', () => {
            log('âœ… Marketplace interface loaded successfully');
        });
    </script>
</body>
</html>